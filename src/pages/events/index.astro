---
import BaseLayout from '@layouts/BaseLayout.astro';
import PageHeader from '@components/Sections/PageHeader.astro';
import Card from '@components/UI/Card.astro';
import { getCollection } from 'astro:content';
import { formatDate, isFutureDate, isPastDate } from '@utils/dateUtils';
import Icon from '@components/UI/Icon.astro';

// Get all events
const allEvents = await getCollection('events', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Separate upcoming and past events
const upcomingEvents = allEvents
  .filter((event) => isFutureDate(event.data.date))
  .sort(
    (a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime(),
  );

const pastEvents = allEvents
  .filter((event) => isPastDate(event.data.date))
  .sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
  )
  .slice(0, 6); // Show only the most recent past events
---

<BaseLayout
  title='Events - Church Name'
  description='Stay updated with upcoming events and activities at our church. Find information on special services, community gatherings, and more.'
>
  <PageHeader
    title='Events'
    subtitle='Join us for these upcoming activities'
    backgroundImage='/uploads/events-header-bg.webp'
  />

  <!-- Upcoming Events -->
  <section class='py-16'>
    <div class='container'>
      <div class='text-center mb-12'>
        <h2 class='text-3xl md:text-4xl font-bold mb-4'>Upcoming Events</h2>
        <p class='text-xl text-gray-600 max-w-3xl mx-auto'>
          Mark your calendar and join us for these upcoming events
        </p>
      </div>

      <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8'>
        {
          upcomingEvents.length > 0 ? (
            upcomingEvents.map((event) => (
              <Card
                title={event.data.title}
                image={{
                  src: event.data.image,
                  alt: event.data.title,
                }}
                href={`/events/${event.slug}`}
              >
                <div class='mb-3 flex items-center text-gray-600'>
                  <Icon name='calendar' class='h-5 w-5 mr-2' />
                  <span>{formatDate(event.data.date)}</span>
                </div>

                {event.data.time && (
                  <div class='mb-3 flex items-center text-gray-600'>
                    <Icon name='clock' class='h-5 w-5 mr-2' />
                    <span>{event.data.time}</span>
                  </div>
                )}

                <div class='mb-3 flex items-center text-gray-600'>
                  <Icon name='location' class='h-5 w-5 mr-2' />
                  <span>{event.data.location}</span>
                </div>

                <p class='text-gray-700 mb-4'>{event.data.summary}</p>

                <p class='text-primary-600 font-medium group-hover:underline group-hover:text-primary-700'>
                  Learn More →
                </p>
              </Card>
            ))
          ) : (
            <div class='col-span-full text-center py-12 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200'>
              <p class='text-gray-500 text-lg italic'>
                No upcoming events scheduled at the moment. Please check back
                later!
              </p>
            </div>
          )
        }
      </div>
    </div>
  </section>

  <!-- Past Events -->
  <section class='py-16 bg-gray-50'>
    <div class='container'>
      <div class='text-center mb-12'>
        <h2 class='text-3xl md:text-4xl font-bold mb-4'>Past Events</h2>
        <p class='text-xl text-gray-600 max-w-3xl mx-auto'>
          Browse some of our recent events
        </p>
      </div>

      {
        pastEvents.length > 0 ? (
          <div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8'>
            {pastEvents.map((event) => (
              <Card
                title={event.data.title}
                image={{
                  src: event.data.image,
                  alt: event.data.title,
                }}
                href={`/events/${event.slug}`}
                class='opacity-90 hover:opacity-100'
              >
                <div class='mb-3 flex items-center text-gray-600'>
                  <Icon name='calendar' class='h-5 w-5 mr-2' />
                  <span>{formatDate(event.data.date)}</span>
                </div>

                <div class='mb-3 flex items-center text-gray-600'>
                  <Icon name='location' class='h-5 w-5 mr-2' />
                  <span>{event.data.location}</span>
                </div>

                <p class='text-gray-700 mb-4'>{event.data.summary}</p>

                <p class='text-primary-600 font-medium group-hover:underline group-hover:text-primary-700'>
                  View Details →
                </p>
              </Card>
            ))}
          </div>
        ) : (
          <div class='text-center py-12 bg-white rounded-lg shadow-sm border border-gray-100'>
            <p class='text-gray-600 italic'>No past events to display.</p>
          </div>
        )
      }
    </div>
  </section>

  <!-- Add Your Event CTA -->
  <section class='py-20 bg-white'>
    <div class='container'>
      <div class='max-w-3xl mx-auto text-center'>
        <h2 class='text-3xl md:text-4xl font-bold mb-6'>
          Have an Event to Share?
        </h2>
        <p class='text-xl text-gray-600 mb-8'>
          If you're planning a church or ministry-related event that you'd like
          to add to our calendar, please contact us.
        </p>

        <a
          href='/contact?subject=Event+Submission'
          class='inline-flex items-center justify-center px-5 py-3 text-base font-medium text-white bg-primary-600 rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2'
        >
          Submit an Event
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
